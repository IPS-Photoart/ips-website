<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Course Information – Indian Photographic Society</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="logo.png">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:'Libre Franklin',Arial,sans-serif;color:#222;background:#fff;line-height:1.6}
a{text-decoration:none;color:inherit}
nav{background:#0f2a44;padding:14px 0;text-align:center}
nav a{color:#fff;margin:0 16px;font-size:14px;font-weight:500}
.banner{background:url("assets/img/banner.jpg") center/cover;height:260px;color:#fff}
.banner-overlay{background:rgba(0,0,0,.55);height:100%;display:flex;align-items:center;padding:40px}
.logo-section{text-align:center;margin:30px 0 10px}
.logo-section img{width:140px}
button{padding:10px 20px;background:#0f2a44;color:#fff;border:none;border-radius:4px}
footer{background:#0f2a44;color:#fff;padding:25px;text-align:center;font-size:13px;margin-top:60px}
.certificate-selector{text-align:center;margin:25px 0}
.certificate-dropdown{min-width:280px;padding:10px;background:#0f2a44;color:#fff;border-radius:4px}
</style>
</head>

<body>

<nav>
<a href="index.html">Home</a>
<a href="course.html">Course Info</a>
<a href="verify.html">Verify Certificate</a>
</nav>

<div class="banner"><div class="banner-overlay">
<h1>Certificate Programmes</h1>
</div></div>

<div class="logo-section"><img src="assets/img/logo.png"></div>

<div class="certificate-selector">
<label>Select your Certificate –</label><br>
<select class="certificate-dropdown" onchange="goToCertificate(this.value)">
<option value="">-- Select Certificate --</option>
</select>
</div>

<div id="exam-container" style="max-width:800px;margin:30px auto;">
<h2 id="exam-title"></h2>
<div id="exam-meta">
<span id="exam-duration"></span> | 
<span id="exam-timer" style="font-weight:bold"></span>
</div>

<form id="exam-form">
<div id="questions-area"></div>
<div style="margin-top:25px;text-align:center">
<button type="submit">Submit Exam</button>
</div>
</form>
</div>

<footer>© Indian Photographic Society</footer>

<script>
const API_BASE="https://ips-fastapi-backend.onrender.com";
</script>

<script>
async function loadCertificates(){
const r=await fetch(`${API_BASE}/certificates`);
const d=await r.json();
document.querySelectorAll(".certificate-dropdown").forEach(s=>{
d.forEach(c=>{
const o=document.createElement("option");
o.value=c.code;o.textContent=c.title;s.appendChild(o);
});
});
}
function goToCertificate(c){if(c)location=`course.html?certificate=${c}`}
document.addEventListener("DOMContentLoaded",loadCertificates);
</script>

<script>
const params=new URLSearchParams(location.search);
const CERTIFICATE_CODE=params.get("certificate");
</script>

<script>
let examData,remainingSeconds,timerInterval;

async function loadExam(){
if(!CERTIFICATE_CODE)return;

const r=await fetch(`${API_BASE}/exam/${CERTIFICATE_CODE}/questions`);
examData=await r.json();

document.getElementById("exam-title").innerText=examData.certificate;
document.getElementById("exam-duration").innerText=`Duration: ${examData.duration_minutes} minutes`;

remainingSeconds=examData.duration_minutes*60;
startTimer();
renderQuestions();
}

function startTimer(){
updateTimer();
timerInterval=setInterval(()=>{
remainingSeconds--;updateTimer();
if(remainingSeconds<=0){
clearInterval(timerInterval);
alert("Time is up");document.getElementById("exam-form").requestSubmit();
}
},1000);
}

function updateTimer(){
const m=Math.floor(remainingSeconds/60);
const s=remainingSeconds%60;
document.getElementById("exam-timer").innerText=`Time Left: ${m}:${s.toString().padStart(2,"0")}`;
}

<script>
function renderQuestions() {
  const area = document.getElementById("questions-area");
  area.innerHTML = "";

  if (!examData.questions || examData.questions.length === 0) {
    area.innerHTML = "<p><em>No questions available.</em></p>";
    return;
  }

  examData.questions.forEach((q, index) => {
    const block = document.createElement("div");
    block.style.marginBottom = "22px";

    let html = `
      <div style="margin-bottom:8px;">
        <strong>Q${index + 1}. ${q.question}</strong>
      </div>
    `;

    q.options.forEach((opt, i) => {
      html += `
        <div>
          <label>
            <input type="radio"
                   name="q_${q.id}"
                   value="${i + 1}">
            ${opt}
          </label>
        </div>
      `;
    });

    block.innerHTML = html;
    area.appendChild(block);
  });
}
</script>

document.addEventListener("DOMContentLoaded",loadExam);
</script>

<script>
<script>
document.getElementById("exam-form").addEventListener("submit", function (e) {
  e.preventDefault();
  clearInterval(timerInterval);

  const answers = [];

  if (examData && examData.questions) {
    examData.questions.forEach(q => {
      const selected = document.querySelector(
        `input[name="q_${q.id}"]:checked`
      );

      answers.push({
        question_id: q.id,
        selected_option: selected ? selected.value : null
      });
    });
  }

  console.log("Submitted answers:", answers);

  alert("Exam submitted successfully. Answers captured.");
});
</script>

</script>

</body>
</html>

